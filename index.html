<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/hover.css">
    <link rel="stylesheet" href="css/scroll.css">
    <link rel="icon" href="images/logo.ico">
    <link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css"
        integrity="sha384-AYmEC3Yw5cVb3ZcuHtOA93w35dYTsvhLPVnYs9eStHfGJvOvKxVfELGroGkvsg+p" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
        integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"
        integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
    <title>CLO - Os Melhores Brechós</title>


</head>

<body class="all">

    <!-- navbar  -->

    <div class="bs-example">
        <nav class="navbar navbar-expand-md navbar-light bg-light">
            <a href="#" class="navbar-brand hvr-float-shadow">
                <!-- <p class="navbar-brand logo-clo nomargin" href="#">Clo</p> -->
                <img src="images/logoclo.svg" class="" height="50" alt="Logo Clo">
            </a>
            <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbarCollapse">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarCollapse">
                <div class="navbar-nav">

                </div>
                <div class="navbar-nav ml-auto">
                    <form class="form-inline my-2 my-lg-0 pr-4 pt-2">
                        <input class="navsearchbar form-control bg-light border-dark mr-sm-2" id="buscar" type="search"
                            placeholder="Buscar" aria-label="Search">
                        <button class="btn btn-outline-dark my-2 my-sm-0 navsearchbutton" type="submit"><i
                                class="fas fa-search"></i></button>
                    </form>
                    <a href="pages/sacola.html" class="hvr-underline-from-center nav-item nav-link icones-navbar"><span
                            class="d-md-none">Sacola</span> <i class="fas fa-shopping-bag"></i></a>
                    <a href="pages/login.html" id="perfilIcon" class="hvr-underline-from-center nav-item nav-link icones-navbar "><span
                            class="d-md-none">Perfil</span> <img id="imgPerfil" class="rounded-circle imgprofile" src="" alt=""> <i id="icone" class="fas fa-user-circle"></i></a>
                </div>
            </div>
        </nav>
    </div>

    <!-- fim da navbar  -->

    <!-- banner  -->

    <div class="banner">
        <span class="background"></span>
    </div>

    <!-- fim do banner  -->

    <!-- card desconto  -->

    <div class="container-fluid card-produto ">
        <div class="row">
            <div class="col-md-12">
                <div class="title1">
                    <h2>Produtos <span>em</span> <b>Desconto</b></h2>
                </div>
                <div class="carousel slide" data-ride="carousel" data-interval="0">

                    <div class="carousel-inner">
                        <!-- parte 1 -->
                        <div class="carousel-item active">
                            <div class="row btnreset" id="produtos1">



                            </div>
                        </div>
                    </div>
                    <p class="mx-auto text-center pontinho d-lg-none">•</p>
                    <div class="row mt-2">
                        <button onclick="maisProdutos()" class="vermais mx-auto">Ver Mais Produtos...</button>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- fim do card desconto -->




    <hr class="linha2">



    <!-- card destaque  -->

    <div class="container-fluid card-produto ">
        <div class="row">
            <div class="col-md-12">
                <div class="title1">
                    <h2>Produtos <span>em</span> <b>Destaque</b></h2>
                </div>
                <div class="carousel slide" data-ride="carousel" data-interval="0">

                    <div class="carousel-inner">
                        <div class="carousel-item active">
                            <div class="row btnreset" id="produtos2">



                            </div>
                        </div>
                    </div>
                    <p class="mx-auto text-center pontinho d-lg-none">•</p>
                    <div class="row mt-2">
                        <a href="#" class="vermais mx-auto">Ver Mais Produtos...</a>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- fim card destaque   -->

    <hr class="linha2">

    <!-- brechos em destaque -->

    <div class="container ck">
        <div class="title1">
            <h2>Brechós Parceiros</h2>
        </div>
        <div class="">

            <div class="row btnreset" id="brechosParceiros">

            </div>
        </div>
    </div>

    <!-- fim brechos em destaque xl, lg, md -->




    <br><br><br><br>

    <!-- Footer -->
    <footer class="page-footer footer font-small blue pt-4">
        <!-- Footer Links -->
        <div class="container text-center text-md-left">

            <!-- Grid row -->
            <div class="row">

                <!-- Grid column -->
                <div class="col-md-6 mt-md-0 mt-3">

                    <!-- Content -->
                    <h5 class="text-light">Clo</h5>
                    <p>"Clo" é um serviço que reune os melhores brechós do Brasil e facilita a compra do usuário.</p>

                </div>
                <!-- Grid column -->

                <hr class="clearfix w-100 d-md-none pb-3">

                <!-- Grid column -->
                <div class="col-md-3 mb-md-0 mb-3">

                    <!-- Links -->
                    <h5 class="text-light">Links</h5>

                    <ul class="list-unstyled">
                        <li>
                            <a href="#">Home</a>
                        </li>
                        <li>
                            <a href="pages/login.html">Perfil</a>
                        </li>
                        <li>
                            <a href="pages/cart.html">Sacola</a>
                        </li>
                    </ul>

                </div>
                <!-- Grid column -->

                <!-- Grid column -->
                <div class="col-md-3 mb-md-0 mb-3">

                    <!-- Links -->
                    <h5 class="text-light">Redes Sociais</h5>

                    <ul class="list-unstyled">
                        <li>
                            <a href="https://www.instagram.com/clobrechos/?hl=pt-br" target="_blank">Instagram</a>
                        </li>
                        <li>
                            <a href="https://www.facebook.com/clo.brechos.7" target="_blank">Facebook</a>
                        </li>
                        <li>
                            <a href="https://twitter.com/clo_brechos" target="_blank">Twitter</a>
                        </li>
                    </ul>

                </div>
                <!-- Grid column -->

            </div>
            <!-- Grid row -->

        </div>
        <!-- Footer Links -->

        <!-- Copyright -->
        <div class="footer-copyright text-center py-3">© 2020 Copyright:
            <a href="./index.html">clo.com.br</a>
        </div>
        <!-- Copyright -->

    </footer>
    <!-- Footer -->


    <script>
        


        var form = document.querySelector('form')
        form.addEventListener('submit', function (e) {
            e.preventDefault()

            var buscar = document.getElementById('buscar').value

            var a = buscar;
            console.log(a)
            localStorage.setItem("buscar", a)


            console.log(buscar)
            return window.location = "pages/ListBrecho.html"
        })

        var lockdados;
        var produtosAtivos = 5

        function maisProdutos() {
            produtosAtivos += 6
            var maisProdutos = ""
            var contProdutos = 0

            for (let i = 0; i < lockdados.length; i++) {
                if (lockdados[i].desconto) {
                    contProdutos++
                    maisProdutos +=
                        "<div class='col-xl-2 col-lg-4 col-md-4 col-sm-6 col-12 card-prod'" +
                        "<div class='thumb-wrapper'>" +
                        "<button type='button' onclick='a(`" + lockdados[i]._id + "`)' >" +
                        "<div class='img-box'>" +
                        "<img id='imagePeril' src='" + lockdados[i].image.location + "' class='img-fluid'>" +
                        "</div>" +
                        "<div class='thumb-content'>" +
                        "<h4>" + lockdados[i].style + "</h4>" +
                        "<p class='item-price'><span class='font-cut'> R$" + lockdados[i].price + "</span> R$" + lockdados[i].desconto + "</p>" +
                        "</p>" +
                        "<p class='item-name mt-1 mb-3'>Brecho: " + lockdados[i].adm.name + "</p>" +
                        "</button>" +

                        "<button type='button' onclick='addBag(`" + products[i]._id + "`)' class='btn btn-primary btn-cart'>Adicionar ao Carrinho</button>" +
                        "</div>" +
                        "</div>" +
                        "</div>"
                    if (contProdutos == produtosAtivos) {
                        break;
                    }
                }
            }
            $('#produtos1').html(maisProdutos)
        }

        document.addEventListener("DOMContentLoaded", function () {




            fetch(`https://clo2020.herokuapp.com/listproducts`, {
                method: "get",
                headers: { 'Content-Type': 'application/json', 'Authorization': localStorage.getItem('token') }

            })
                .then((resposta) => {
                    resposta.json().then((dados) => {
                        var { products } = dados;
                        for (produtos of products) {

                        }
                        lockdados = products




                        var contProdutos = []

                        // Exibindo produtos
                        var produtos = ""

                        for (let i = 0; i < products.length; i++) {
                            if (products[i].desconto) {
                                contProdutos.push(products[i])

                                produtos +=
                                    "<div class='col-xl-2 col-lg-4 col-md-4 col-sm-6 col-12 card-prod'" +
                                    "<div class='thumb-wrapper'>" +
                                    "<button type='button' onclick='a(`" + products[i]._id + "`)' >" +
                                    "<div class='img-box'>" +
                                    "<img id='imagePeril' src='" + products[i].image.location + "' class='img-fluid'>" +
                                    "</div>" +
                                    "<div class='thumb-content'>" +
                                    "<h4>" + products[i].style + "</h4>" +
                                    "<p class='item-price'><span class='font-cut'> R$" + products[i].price + "</span> R$" + products[i].desconto + "</p>" +
                                    "</p>" +
                                    "<p class='item-name mt-1 mb-3'>Brecho: " + products[i].adm.name + "</p>" +

                                    "</button>" +
                                    "<button type='button' onclick='addBag(`" + products[i]._id + "`)' class='btn btn-primary btn-cart'>Adicionar ao Carrinho</button>" +
                                    "</div>" +
                                    "</div>" +
                                    "</div>"

                                if (contProdutos.length == 6) {
                                    break;
                                }
                            }
                        }

                        $('#produtos1').html(produtos)

                        var produtos2 = ""

                        for (let i = 0; i <= 5; i++) {
                            if (!products[i].desconto) {
                                produtos2 +=
                                    "<div class='col-xl-2 col-lg-4 col-md-4 col-sm-6 col-12 card-prod'" +
                                    "<div class='thumb-wrapper'>" +
                                    "<button type='button' onclick='a(`" + products[i]._id + "`)' >" +
                                    "<div class='img-box'>" +
                                    "<img id='imagePeril' src='" + products[i].image.location + "' class='img-fluid'>" +
                                    "</div>" +
                                    "<div class='thumb-content'>" +
                                    "<h4>" + products[i].style + "</h4>" +
                                    "<p class='item-price'> R$" + products[i].price + "</span></p>" +
                                    "</p>" +
                                    "<p class='item-name mt-1 mb-3'>Brecho: " + products[i].adm.name + "</p>" +
                                    "</button>" +

                                    "<button type='button'  onclick='addBag(`" + products[i]._id + "`)' class='btn btn-primary btn-cart'>Adicionar ao Carrinho</button>" +
                                    "</div>" +
                                    "</div>" +
                                    "</div>"
                            }
                        }
                        $('#produtos2').html(produtos2)

                    })
                })
            var btnProduto = document.querySelector('.btnProdutos')



            fetch(`https://clo2020.herokuapp.com/listAdms`, {
                method: "get",
                headers: { 'Content-Type': 'application/json', 'Authorization': localStorage.getItem('token') }

            })
                .then((resposta) => {
                    resposta.json().then((dados) => {
                        const { adms } = dados
                        var brechos = ""

                        for (let i = 0; i <= 5; i++) {
                            // console.log(adms[i].image  )
                            // console.log(adms[i]._id)


                            brechos +=
                                "<div class='col-lg-2 col-md-2 col-4 text-center brechos-destaque hvr-underline-reveal'>" +
                                "<button class='btnreset' onclick='buscarBrecho(`" + adms[i]._id + "`)'>" +
                                "<img class='rounded-circle image-circle img-fluid' alt='Imagem Brechó Parceiro'" +
                                "src='" + adms[i].image.location + "' data-holder-rendered='true'>" +

                                "<p class='txt-brecho'>" + adms[i].name + "</p>" +
                                "</button>" +
                                "</div>"
                        }
                        $('#brechosParceiros').html(brechos)

                    })
                })
            var perfilIcon = document.getElementById('perfilIcon')
            var icone = document.getElementById('icone')
            fetch(`https://clo2020.herokuapp.com/loadUser`, {
            method: "GET",
            headers: { 'Content-Type': 'application/json', 'Authorization': localStorage.getItem('token') }
            })
            .then((resposta) => {
                resposta.json().then((dados) => {
                    console.log(dados)
                    if(dados.sacola){
                        // console.log("s")
                        perfilIcon.href = "pages/user-profile.html"
                        if(!dados.image){
                            imgPerfil.src = "images/user-example.png"
                        }
                        else{
                            imgPerfil.src = dados.image.location
                        }
                            
                        icone.style.visibility = "hidden"
                        
                    }
               
                })
            })
            fetch(`https://clo2020.herokuapp.com/loadAdm`, {
            method: "GET",
            headers: { 'Content-Type': 'application/json', 'Authorization': localStorage.getItem('token') }
            })
            .then((resposta) => {
                resposta.json().then((dados) => {
                    console.log(dados)
                    if(dados.products){
                        console.log("s")
                        perfilIcon.href = "pages/brecho-profile.html"
                        imgPerfil.src = dados.image.location
                        icone.style.visibility = "hidden"
                    }
               
                })
            })
        })


        function addBag(idSacola){
            console.log(idSacola)
            localStorage.setItem('sacolaId', idSacola)
            // window.location = "pages/sacola.html"
            fetch(`https://clo2020.herokuapp.com/addBag`, {
                method: "POST",
                headers: { 'Content-Type': 'application/json', 'Authorization': localStorage.getItem('token') },
                body: JSON.stringify({
                   id: idSacola
                })
            })
            .then((resposta) => {
                resposta.json().then((dados) => {
                  
                    console.log(dados)
                })
            })
        }
        function a(id) {
            window.location = "pages/product.html"

            localStorage.setItem("produtoId", id)
        }

        function buscarBrecho(id) {
            console.log(id)
            window.location = "pages/pagBrecho.html"

            localStorage.setItem("brechoId", id)
        }

    </script>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
        integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
        integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"
        integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV"
        crossorigin="anonymous"></script>
</body>






</html>